# 哨兵集群

哨兵实例通过 Redis 的发布/订阅机制组成集群。哨兵和主库建立连接，把自己的连接信息发布出去，同时订阅其他哨兵的连接信息。

### 哨兵-从库

哨兵通过发送 INFO 命令给主库来查询从库列表。

### 哨兵-客户端

本质上哨兵是一个特定模式运行的 Redis 实例，它自己也提供发布/订阅机制，因此客户端可以订阅哨兵的消息。
例如：

* 主库下线事件
* 从库重新配置事件
* 新主库切换事件

### 执行者

具体由哪个哨兵来执行主库切换也是一个投票的过程。

* 一个哨兵实例判断主库下线后，发送 is-master-down-by-addr 给其他实例，其他实例根据自己与主库连接的判断做出 Y/N 的响应，表示 赞成/反对。
* 一个哨兵获取到仲裁所需的赞成票后，开始选举 Leader 执行下线。

**leader 选举**

想成为 Leader 的哨兵，要满足两个条件：
1. 拿到半数以上的赞成票；
2. 拿到的票数同时还需要大于等于哨兵配置文件中的 quorum 值。以 3 个哨兵为例，假设此时的 quorum 设置为 2，那么，任何一个想成为 Leader 的哨兵只要拿到 2 张赞成票，就可以了。